<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>OTP Verification</title>
    <link rel="stylesheet" href="user_assets/css/main.css?v=3.4">
    <style>
        .resend {
            margin-top: 20px;
        }
        #timer {
            font-weight: bold;
        }
        #resendButton {
            margin-top: 10px;
        }
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            let timer = 30; // 30 seconds countdown
            const countdownElement = document.getElementById('timer');
            const resendButton = document.getElementById('resendButton');

            const countdown = setInterval(() => {
                if (timer <= 0) {
                    clearInterval(countdown);
                    resendButton.disabled = false;
                    countdownElement.innerHTML = 'OTP expired. Please request a new one.';
                } else {
                    countdownElement.innerHTML = `Time remaining: ${timer} seconds`;
                    timer--;
                }
            }, 1000);

            resendButton.addEventListener('click', function() {
                resendButton.disabled = true;
                timer = 30; // Reset timer to 30 seconds
                countdownElement.innerHTML = `Time remaining: ${timer} seconds`;

                fetch('/resend-otp', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email: '<%= email %>' })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('A new OTP has been sent to your email.');
                    } else {
                        alert('Failed to send OTP. Please try again.');
                    }
                })
                .catch(error => {
                    console.error('Error resending OTP:', error);
                });
            });
        });
    </script>
</head>
<body>
    <div class="container" style="margin-top: 150px; margin-left: 300px;">
        <div class="otp_wrap">
            <div class="heading_s1">
                <h3 class="mb-30">Enter OTP</h3>
            </div>
            <form action="/verifyotp" method="post">
                <div class="form-group">
                    <input type="hidden" name="email" value="<%= email %>">
                    <input type="text" required name="otp" placeholder="Enter OTP" maxlength="6">
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-fill-out btn-block hover-up" name="submit">Submit</button>
                </div>
            </form>
            <div class="resend">
                <span id="timer">30 seconds</span> <br>
                <button id="resendButton" disabled>Resend OTP</button>
            </div>
        </div>
    </div>
</body>
</html>
